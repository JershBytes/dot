- name: Privileged Setup
  hosts: localhost
  vars:
    remote_regular_user: "{{ ansible_user }}"
  become: true
  connection: localhost
  gather_facts: true

  tasks:
    - name: Create the `aur_builder` user
      become: yes
      ansible.builtin.user:
        name: aur_builder
        create_home: yes
        group: wheel

    - name: Allow the `aur_builder` user to run `sudo pacman` without a password
      become: yes
      ansible.builtin.lineinfile:
        path: /etc/sudoers.d/11-install-aur_builder
        line: 'aur_builder ALL=(ALL) NOPASSWD: /usr/bin/pacman'
        create: yes
        mode: 0644
        validate: 'visudo -cf %s'

   

- name: Non-Privileged Setup
  hosts: localhost
  vars:
    remote_regular_user: "{{ ansible_user }}"
  become: false
  connection: localhost
  gather_facts: true

  tasks:
    - name: Install packages from AUR
      kewlfft.aur.aur:
        name:
          - vscodium-bin
          - terraform-bin
          - neovim-git
          - docker-git
          - goxlr-utility
          - goxlr-utility-ui
        state: present
        update_cache: true
    
    - name: Install Brew packages
      community.general.homebrew:
        name:
          - ripgrep
          - fd
          - zig
          - neovim
          - lazygit
          - oh-my-posh
          - lolcat
          - fortune
          - cowsay
          - yazi
          - fzf
          - zoxide
          - neovide
        state: present

    - name: Install Flatpak packages
      community.general.flatpak:
        name:
          - tv.plex.PlexDesktop
          - dev.aunetx.deezer
          - com.bitwarden.desktop
          - dev.vencord.Vesktop
          - org.kde.haruna
        state: present
